<%= render 'public/customers/list', customers: @customers %>

<h3>注文情報確認</h3>

<table>
  
  <thead>
    
    <tr>
      
      <th>商品名</th>
      <th>単価(税込)</th>
      <th>数量</th>
      <th>小計</th>
      
    </tr>
    
  </thead>
  
  <% total = 0 %>
  
  <% @cart_items.each do |cart_item| %>
  
  <tbody>
    
    <tr>
      
      <td>
        
        <%= image_tag cart_item.item.get_image(100,100)%>
        <%= cart_item.item.name %>
        
      </td>
      <td><%= cart_item.item.with_tax_price %></td>
      <td><%= cart_item.amount %></td>
      <td><%= cart_item.subtotal %></td>
      
    </tr>
    
    <% total += cart_item.subtotal %>
    
  </tbody>
  
  <% end %>
  
</table>

<% @order.shipping_cost = 800 %>

<table>
  
  <tr>
    
    <th>送料</th>
    <td>￥<%= @order.shipping_cost %></td>
    
  </tr>
  
  <tr>
    
    <th>商品合計</th>
    <td>￥<%= total %></td>
    
  </tr>
  
  <tr>
    
    <th>請求金額</th>
    <td>￥<%= total += @order.shipping_cost %></td>
    
  </tr>
  
</table>

<div>
  
<%= @order.payment_method_i18n %>
  
</div>
<div>
<%= @order.postal_code %>
<%= @order.address_area %>
<%= @order.addressee_name %>
</div>

<%= form_with model: @order , url: decision_path do |f| %>

<%= f.hidden_field :payment_method, value: @order.payment_method %>

<%= f.hidden_field :postal_code, value: @order.postal_code %>

<%= f.hidden_field :address_area, value: @order.address_area%>

<%= f.hidden_field :addressee_name, value: @order.addressee_name %>

<%= f.hidden_field :shipping_cost, value: @order.shipping_cost %>

<%= f.hidden_field :payment_amount ,value: total += @order.shipping_cost %>

<%= f.hidden_field :customer_id, value: current_customer.id %>

<%= f.submit "注文を確定する" %>

<% end %>